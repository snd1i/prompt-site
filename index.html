<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Site</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#f0f0f0;}
  .credit { font-size: 18px; margin-bottom: 20px; }
  .card { background:#fff; padding:15px; margin-bottom:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
  .card img { max-width:100%; border-radius:5px; }
  .card button { margin-top:10px; padding:8px 12px; border:none; background:#4CAF50; color:white; border-radius:5px; cursor:pointer;}
  #watchAd { background:#FF5722; margin-bottom:20px; padding:10px 15px; border:none; color:white; border-radius:5px; cursor:pointer;}
</style>

<!-- AdsGram SDK -->
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>

</head>
<body>

<div class="credit">Credits: <span id="credit">0</span></div>
<button id="watchAd">Watch Ad → +2 Credits</button>

<script>
// Kullanıcı ID'sini al
function getUserId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("userId") || "guest";
}
const userId = getUserId();

// Kredi sistemi
let credit = localStorage.getItem("credit_" + userId);
if (credit === null) { credit = 5; localStorage.setItem("credit_" + userId, credit); }
credit = parseInt(credit);
document.getElementById("credit").innerText = credit;

// Sheet ID ve adı
const SHEET_ID = "1a4gxpaMg2gHNP9krJtVtqmDwMsvpY1KD1tqIes6zNNY";
const SHEET_NAME = "Sheet1";
const URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;

// Fetch promptlar
fetch(URL)
.then(res => res.json())
.then(data => {
  const container = document.createElement("div");
  data.forEach((item, i) => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${item.image}">
      <button onclick="unlock(${i})">Unlock Prompt (1 Credit)</button>
      <p id="p${i}" style="display:none;margin-top:10px;">${item.prompt}</p>
    `;
    container.appendChild(card);
  });
  document.body.appendChild(container);
})
.catch(err => {
  alert("Sheet error");
  console.log(err);
});

// Unlock fonksiyonu
function unlock(i){
  if(credit<=0){ alert("No credits"); return; }
  credit--;
  localStorage.setItem("credit_" + userId, credit);
  document.getElementById("credit").innerText = credit;
  document.getElementById("p"+i).style.display = "block";
}

// AdsGram başlat (Rewarded Ad)
const AdController = window.Adsgram.init({ 
    blockId: "20767", 
    rewardUrl: "https://snd1i.github.io/prompt-site/?userId=[userId]"
});

// Watch Ad butonu
document.getElementById("watchAd").addEventListener("click", () => {
    AdController.showRewardedAd()
    .then(() => {
        credit += 2;
        localStorage.setItem("credit_" + userId, credit);
        document.getElementById("credit").innerText = credit;
        alert("You earned 2 credits!");
    })
    .catch(() => {
        alert("Ad not completed or failed.");
    });
});
</script>

</body>
</html>

